<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>DAPP Auction</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <style>
    .loader {
        border: 16px solid #f3f3f3; /* Light grey */
        border-top: 16px solid #34db50; /* Green */
        border-radius: 50%;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <header>
        <nav class="navbar fixed-top navbar-expand-lg navbar-light navbar-light" style="background-color: #e3f2fd;">
            <a class="navbar-brand" href="#">
                <img src="images/auctionIcon.png" width="30" height="30" class="d-inline-block align-top"
                    alt="">
               AuctManager
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01"
                aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
        </nav>
    </header>

    <div class="container" style="padding-top: 60px;">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <p>Address: <span id="userAddress" class="badge badge-success"></span></p>
                <p>Balance: <span id="userBalance" class="badge badge-success"></span></p>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <a class="nav-item nav-link active" id="nav-english-tab" data-toggle="tab" href="#nav-english" role="tab"
                            aria-controls="nav-english" aria-selected="true" 
                            onclick="if (!$(this).hasClass('active')) {App.retriveEngInfo();} return false;">English Auctions 
                            <span class="badge badge-warning" id="eventEngBadge"></span></a>
                        <a class="nav-item nav-link" id="nav-vicrey-tab" data-toggle="tab" href="#nav-vicrey" role="tab"
                            aria-controls="nav-vicrey" aria-selected="false" 
                            onclick="if (!$(this).hasClass('active')) {App.retriveVicInfo();} return false;">Vicrey Auctions
                            <span class="badge badge-warning" id="eventVicBadge"></span></a>
                        <a class="nav-item nav-link" id="nav-managing-tab" data-toggle="tab" href="#nav-managing" role="tab"
                            aria-controls="nav-managing" aria-selected="false"></a>
                    </div>
                </nav>
                <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="nav-english" role="tabpanel" aria-labelledby="nav-english-tab">
                        <div class="container" id="engOwn" style="display: none;">
                            <div class="row">
                                <div class="col-xs-12 col-sm-12 mt-2">
                                    <h5>Owned Auctions</h5>
                                    <hr />
                                </div>
                            </div>
                        </div>
                        <div class="container" id="engOpe" style="display: none;">
                            <div class="row">
                                <div class="col-xs-12 col-sm-12 mt-2">
                                    <h5>Open Auctions</h5>
                                    <hr />
                                </div>
                            </div>
                        </div>
                        <div class="container" id="engClo" style="display: none;">
                            <div class="row">
                                <div class="col-xs-12 col-sm-12 mt-2">
                                    <h5>Closing Auctions</h5>
                                    <hr />
                                </div>
                            </div>
                        </div>
                        <div class="row loaderEnglishRow" style="display: none;">
                            <div class="col-12 d-flex justify-content-center mt-5">
                                <div class="loader loaderEnglish"></div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-vicrey" role="tabpanel" aria-labelledby="nav-vicrey-tab">
                        <div class="container" id="vicOwn" style="display: none;">
                            <div class="row">
                                <div class="col-xs-12 col-sm-12 mt-3">
                                    <h5>Owned Auctions</h5>
                                    <hr />
                                </div>
                            </div>
                        </div>
                        <div class="container" id="vicOpe" style="display: none;">
                            <div class="row">
                                <div class="col-xs-12 col-sm-12 mt-2">
                                    <h5>Open Auctions</h5>
                                    <hr />
                                </div>
                            </div>
                        </div>
                        <div class="container" id="vicClo" style="display: none;">
                            <div class="row">
                                <div class="col-xs-12 col-sm-12 mt-2">
                                    <h5>Closing Auctions</h5>
                                    <hr />
                                </div>
                            </div>
                        </div>
                        <div class="row loaderVicreyRow" style="display: none;">
                            <div class="col-12 d-flex justify-content-center mt-5">
                                <div class="loader loaderVicrey"></div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-managing" role="tabpanel" aria-labelledby="nav-managing-tab">
                        <div class="container JUSTIFY-CONTENT-CENTER" id="createContainer">
                            <div class="row">
                                <div class="col-xs-8 col-sm-8 mt-2">

                                </div>
                            </div>
                        </div>
                        <div class="container" id="createContainer">
                            <div class="row">
                                <div class="col-xs-8 col-sm-8 mt-2">
                                    <p>Here you can create an auction</p>
                                </div>
                                <div class="col-xs-8 col-sm-8 mt-2">
                                    <div class="input-group mt-2">
                                        <div class="input-group-prepend">
                                            <label class="input-group-text" for="inputGroupSelect01">Type</label>
                                        </div>
                                        <select class="custom-select" id="createType">
                                            <option value="0" selected>Choose...</option>
                                            <option value="eng">English</option>
                                            <option value="vic">Vicrey</option>
                                        </select>
                                    </div>
                                    <span class="text-danger" id="errorSpanType"></span>
                                </div>
                                <div class="col-xs-8 col-sm-8 mt-2">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">Title</span>
                                        </div>
                                        <input type="text" class="form-control" id="createTitle" value="">
                                    </div>
                                    <span class="text-danger" id="errorSpanTitle"></span>
                                </div>
                                <div class="col-xs-8 col-sm-8 mt-2">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">Description</span>
                                        </div>
                                        <textarea class="form-control" aria-label="With textarea" id="createDescription"></textarea>
                                    </div>
                                    <span class="text-danger" id="errorSpanDescription"></span>
                                </div>
                                <div class="col-xs-8 col-sm-8 mt-2">
                                    <div class="input-group mt-2 mb-2">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text" id="spanBuyDep"></span>
                                        </div>
                                        <input type="text" class="form-control" placeholder="..." id="createBuyDep" value="">
                                        <div class="input-group-append">
                                            <select class="custom-select" id="measureBuyDep">
                                                <option value="eth" selected="">E</option>
                                                <option value="wei">W</option>
                                            </select>
                                        </div>
                                    </div>
                                    <span class="text-danger" id="errorSpanBuyDep"></span>
                                </div>
                                <div class="col-xs-8 col-sm-8 mt-2">
                                    <div class="input-group mt-2 mb-2">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">Reserve Price</span>
                                        </div>
                                        <input type="text" class="form-control" placeholder="" id="createReserve" value="">
                                        <div class="input-group-append">
                                            <select class="custom-select" id="measureReserve">
                                                <option value="eth" selected="">E</option>
                                                <option value="wei">W</option>
                                            </select>
                                        </div>
                                    </div>
                                    <span class="text-danger" id="errorSpanReserve"></span>
                                </div>
                                <div class="col-xs-8 col-sm-8 mt-2" style="display: none" id="bidIncrCol">
                                    <div class="input-group mt-2 mb-2">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">Bid Increment</span>
                                        </div>
                                        <input type="text" class="form-control" placeholder="" id="createIncrement" value="">
                                        <div class="input-group-append">
                                            <select class="custom-select" id="measureIncrement">
                                                <option value="eth" selected="">E</option>
                                                <option value="wei">W</option>
                                            </select>
                                        </div>
                                    </div>
                                    <span class="text-danger" id="errorSpanIncrement"></span>
                                </div>
                                <div class="col-xs-8 col-sm-8 mt-2">
                                    <button type="button" class="btn btn-outlint btn-primary mb-2 "
                                        onclick="App.createAuction(); return false;" id="createBtn">Create Auction</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div style="display: none;" class="card border-success auctionTemplate h-100">
        <div class="card-body text-dark">
            <h5 class="text-center"></h5>
            <h6 class="text-center text-primary"></h6>
            <ul class="list-group list-group-flush">
            </ul>
        </div>
        <div class="card-footer">
            <small class="text-muted"></small>
        </div>
    </div>
    
    <!-- Modal to compute sha3 in commitment phase -->
    <div class="modal fade" id="sha3Modal" tabindex="-1" role="dialog" aria-labelledby="computeSha3Modal"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Compute Sha3 of Solidity</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body border-primary">
                    Here you can compute the Sha3 of your bid consinst with Slodity Sha3 function. Insert the Nonce and the Bid amount:
                    <div class="input-group mt-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Nonce</span>
                        </div>
                        <input type="text" class="form-control" placeholder="Text nonce" id="nonceSha3" value="">
                    </div>
                    <span class="text-danger" id="errorSpanNonce"></span>
                    <div class="input-group mt-2 mb-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Bid amount</span>
                        </div>
                        <input type="text" class="form-control" placeholder="Bid amount" id="amountSha3" value="">
                        <div class="input-group-append">
                            <select class="custom-select" id="measureSha3">
                                <option value="eth" selected="">E</option>
                                <option value="wei">W</option>
                            </select>
                        </div>
                    </div>
                    <span class="text-danger" id="errorSpanAmount"></span>
                    <button type="button" class="btn btn-outlint btn-primary float-right mb-2" onclick="computeSha3(); return false;">Compute Hash</button>
                    <div class="input-group mt-2 mb-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Result</span>
                        </div>
                        <input type="text" class="form-control" value="" id="resultSha3">
                    </div>
                    <span class="text-danger" id="errorSpan"></span>
                    Copy the result in the Commit input!
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/additional-methods.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
<script src="js/web3.min.js"></script>
<script src="js/bootstrap-notify.min.js"></script>
<script src="js/truffle-contract.min.js"></script>
<script src="js/drawUtils.js"></script>
<script src="js/bn.js"></script>
<script src="js/app.js"></script>

<script lang="jquery">
    $(function () {
        $('#createType').change(function () {
            var type = $(this).val();
            if (type == 'eng') {
                $('#spanBuyDep').text("BuyOut Ptice");
                $('#bidIncrCol').show();
            }
            else {
                $('#spanBuyDep').text("Deposit Amount");
                $('#bidIncrCol').hide();
            }
        });
    });
    function computeSha3(reserve) {
        /** < Retrive information */
        var nonce = $('#nonceSha3').val();
        var amount = $('#amountSha3').val();
        var measure = $('#measureSha3').find('option:selected').val();
        $('#resultSha3').val("");

        /** < Check if empty */
        if (nonce == '' || nonce == null) {
            $('#errorSpanNonce').text("The nonce is required!");
            $('#errorSpanAmount').text("");
            $('#errorSpan').text("");
            return false;
        }

        /** < Check if empty */
        if (amount == '' || amount == null) {
            $('#errorSpanAmount').text("The bid amount is required!");
            $('#errorSpanNonce').text("");
            $('#errorSpan').text("");
            return false;
        }

        /** < Convert if needed and check if it is a number*/
        if (measure == 'eth') {
            try {
                amount = web3.utils.toWei(amount, 'ether');
            } catch (error) {
                $('#errorSpanAmount').text("The amount bid must be a number!");
                $('#errorSpanNonce').text("");
                $('#errorSpan').text("");
                return false;
            }
        }
        else {
            try {
                amount = web3.utils.toWei(amount, 'wei');
            } catch (error) {
                $('#errorSpanAmount').text("The amount bid must be a number!");
                $('#errorSpanNonce').text("");
                $('#errorSpan').text("");
                return false;
            }
        }

        try { 
            let result = web3.utils.soliditySha3(nonce, amount);
            $('#resultSha3').val(result);
            $('#errorSpanNonce').text("");
            $('#errorSpanAmount').text("");
            $('#errorSpan').text("");
            return true;
        }
        catch (error) {
            $('#errorSpan').text("An internal error occurred!");
            $('#errorSpanNonce').text("");
            $('#errorSpanAmount').text("");
            return false;
        }
    };
</script>

<!-- FORMM
        <div id="auctionRow" class="row">
            <div class="col-xs-12 col-sm-8 col-sm-push-2">
                <form id="bidForm" class="needs-validation" onSubmit="App.makeBid(); return false;" novalidate>
                    <div class="form-group">
                        <label for="inputBid">Make a Bid (wei)</label>
                        <input type="text" class="form-control" id="inputBid" name="inputBid" placeholder="value" value=""
                            pattern="[0-9]{0,30}$" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Bid</button>
                    <hr />
                </form>
            </div>
        </div> 
    -->
<!-- 
    
<script lang="jquery">
    $(document).ready(function () {

        $('#bidForm').validate({
            rules: {
                inputBid: {
                    required: true,
                    number: true
                }
            },
            messages: {
                inputBid: {
                    required: "Insert an integer value for your bid expressed in Wei!",
                    number: "Must be an integer!"
                }
            }
        });
    });
</script> -->

</html>